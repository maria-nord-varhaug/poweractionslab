name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [workflow_dispatch ]

  
jobs:
  Deploy-Dev:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v2
    - name: Find version number
      run: |
          $fileName = "Annata365Dataverse.*.pdpkg.zip"
          $file = Get-ChildItem -Filter "$fileName" | Select-Object -First 1
          if ($file)
          {
            $fileVersion = [regex]::Match($file.FullName, "[0-9]+\.[0-9]+\.[0-9]+").Value
            echo "ANNATA_DUI_VERSION=$fileVersion" >> "$GITHUB_ENV"
          }
          else {
            exit 1
          }

    - name: Install powerplatform package deployment tool and unzip annatas newest package to right folder
      run: |
        & .\preparePackageDeploymentAndUnzipPackage.ps1 -environment weu-dev-develop -fileVersion ${{env.ANNATA_DUI_VERSION}}
    - name: Install package deployment module
      run: Install-Module -Name Microsoft.Xrm.Tooling.PackageDeployment.Powershell -Force
    - name: See packages that can be deployed
      run: |
        $loc = Get-Location
        Get-CrmPackages -PackageDirectory "$loc\DealerUI installation v.${{env.ANNATA_DUI_VERSION}}\weu-dev-develop\Tools"

